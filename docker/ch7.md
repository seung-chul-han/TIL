# 도커 컴포즈로 분산 애플리케이션 실행하기

- Dockerfile 스크립트는 애플리케이션의 한 부분을 패키징하는 수단이다.
- 이들 컨테이너를 실행하려면 도커 컴포즈 파일에 애플리케이션의 구조를 정의하면 된다.

## 도커 컴포즈 파일

- 애플리케이션의 원하는 상태 (모든 컴포넌트가 실행 중일 때 어떤 상태여야 하는지를 기술하는 파일)
- 또한 docker container run 명령으로 컨테이너를 실행할때 지정하는 모든 옵션을 한데 모아 놓은 단순한 형식의 파일
- 도커 컴포즈를 작성하고 나면 도커 컴포즈 도구를 사용해 애플리케이션을 실행한다.
- 도커 컴포즈가 컨테이너, 네트워크, 볼륨 등 필요한 모든 도커 객체를 만들도록 도커 API에 명령을 내린다.
- yaml 문법으로 기술된다.

```yaml
// 도커 컴포즈 파일 형식의 버전을 가리킨다.
version: '3.7'

// 애플리케이션을 구성하는 모든 컴포넌트를 열거하는 부분.
// 실제 컨테이너 대신 서비스 개념을 단위로 삼는다.
// 하나의 서비스를 같은 이미지로 여러 컨테이너에서 실행할 수 있기 때문이다.
services:
  todo-web:
    image: diamol/ch06-todo-list
    ports:
      - '8020:80'
    networks:
      - app-net

// 서비스 컨테이너가 연결될 모든 도커 네트워크를 열거하는 부분
networks:
  app-net:
    // nat 네트워크가 이미 존재하므로 새로 생성하지 말라는 뜻
    external:
      name: nat
```

서비스 이름은 컨테이너의 이름이자 도커 네트워크상에서 다른 컨테이너들이 해당 컨테이너를 식별하기 위한 DNS네임 으로 쓰인다.

```sh
// 도커 네트워크 생성
docker network create nat

// 애플리케이션을 시작한다.
docker-compose up

```

- docker-compose 명령을 실행하면 먼저 현재 작업 디렉터리에서 docker-compose.yml 파일을 찾는다.
- 해당 파일을 발견하면 to-do 애플리케이션의 정의를 읽어 들인다.
- 현재는 todo-web 서비스를 구성하는 컨테이너가 하나도 없으므로 도커 컴포즈가 컨테이너를 하나 실행한다.

도커 컴포즈 파일에 애플리케이션의 모든 실행 옵션이 기술된다.
그러므로 README 파일에 애플리케이션 이미지 이름이나 공개할 포트 번호를 문서화할 필요가 없다.
