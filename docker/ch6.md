# 도커 볼륨을 이용한 퍼시스턴트 스토리지

도커 컨테이너에도 단일 드라이브로 된 파일 시스템이 있다.
이 시스템의 내용ㅇ은 이미지 파일로부터 만들어 진다.
Dockerfile 스크립트에서 COPY 인스트럭션을 사용해 파일을 이미지로 복사하면
이 이미지로 실행한 컨테이너에도 같은 경로에 복사된 파일이 있다.
컨테이너의 디스크 역시 이 이미지 레이어를 순서대로 합쳐 만든 가상 파일 시스템이다.

같은 이미지에서 실행한 여러 개의 컨테이너는 처음에는 디스크의 내용이 모두 같지만
그중 한 컨테이너에서 애플리케이션이 파일을 수정해도 다른 컨테이너나 이미지는 영향을 받지 않는다.

모든 컨테이너가 공유하는 이미지 레이어는 읽기 전용
각 컨테이너가 따로 갖는 기록 가능 레이어는 컨테이너와 같은 생애주기를 갖는다.
이미지 레이어는 이미지를 내려받는 순간부터 삭제할 때까지 로컬 컴퓨터의 이미지 레이어에 존재한다.
컨테이너 쓰기 가능 레이어는 컨테이너를 실행할 때 생성되며 컨테이너를 삭제할 때 함께 삭제된다.

기록 가능 레이어는 기존 이미지 레이어에 있는 파일을 수정할 수도 있다.
도커는 기록 중 복사 라는 방법을 사용해 읽기 전용 레이어의 파일을 수정할 수 있다.

컨테이너 파일 시스템은 컨테이너와 같은 생애주기를 갖는다. 컨테이너가 삭제 되면 이 컨테이너의 기록 가능 레이어와 여기서 수정된 데이터도 함께 삭제된다.

## 6.2 도커 볼륨을 사용하는 컨테이너 실행하기

도커 볼륨은 도커에서 스토리지를 다루는 단위 (컨테이너를 위한 USB 메모리)
볼륨은 컨테이너와 독립적으로 존재하며 별도의 생애주기를 갖지만 컨테이너에 연결할 수 있다.
볼륨을 생성해 애플리케이션 컨테이너에 연결하면 컨테이너 파일 시스템의 한 디렉터리가 된다.
나중에 애플리케이션을 업데이트하더라도 새로운 컨테이너에 다시 볼륨을 연결하면 데이터가 그대로 유지된다.

컨테이너에서 볼륨을 사용하는 방법

- 수동으로 직접 볼륨을 생성해 컨테이너에 연결
- Dockerfile 스크립트에서 VOLUME 인스트럭션을 사용하는 방법
  `VOLUME <target-directory>`

도커 이미지에서 볼륨을 정의하면 컨테이너를 생성할 때마다 새로운 볼륨을 만든다.
하지만 컨테이너가 같은 볼륨을 공유하게 할 수도 있다.
